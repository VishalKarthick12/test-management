<div class="page-wrapper" style="min-height: 100vh;">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <!-- Nav -->
    <nav class="glass-nav">
        <h1 class="text-2xl font-bold gradient-text">LTTS Admin</h1>
        <button (click)="logout()" class="btn btn-ghost btn-sm" style="color:var(--red);">Logout</button>
    </nav>

    <div class="container py-8 relative z-10">

        <!-- Stats Grid -->
        <div class="grid grid-4 gap-6 mb-8">
            <div class="stat-card">
                <div class="stat-label">Tests Created</div>
                <div class="stat-value indigo">{{ stats.totalTests }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Students Tested</div>
                <div class="stat-value purple">{{ stats.uniqueStudents }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Avg Score</div>
                <div class="stat-value green">{{ stats.avgScore }}%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Questions in Bank</div>
                <div class="stat-value indigo">{{ stats.totalQuestions }}</div>
            </div>
        </div>

        <!-- Actions -->
        <div class="flex-between flex-wrap gap-4 mb-8">
            <h2 class="text-2xl font-bold text-dark">Your Tests</h2>
            <div class="flex gap-3">
                <a routerLink="/admin/create-test" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Create Test
                </a>
                <a routerLink="/admin/question-bank" class="btn btn-ghost">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" />
                    </svg>
                    Question Bank
                </a>
            </div>
        </div>

        <!-- Loading -->
        <div *ngIf="isLoading" class="flex-center py-12">
            <div class="spinner"></div>
        </div>

        <!-- Tests List -->
        <div *ngIf="!isLoading && tests.length > 0" class="glass-card overflow-hidden">
            <div class="overflow-x-auto">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Test Title</th>
                            <th>Duration</th>
                            <th>Questions</th>
                            <th>Attempts</th>
                            <th>Avg Score</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let test of tests">
                            <td class="font-bold text-dark">{{ test.title }}</td>
                            <td class="text-mid">{{ test.duration }} min</td>
                            <td class="text-mid">{{ test.totalQuestions }}</td>
                            <td>
                                <span class="badge badge-primary">{{ test.attemptCount }}</span>
                            </td>
                            <td>
                                <span *ngIf="test.attemptCount > 0" class="font-semibold"
                                    [style.color]="test.avgScore >= 60 ? 'var(--green)' : 'var(--red)'">
                                    {{ test.avgScore }}%
                                </span>
                                <span *ngIf="test.attemptCount === 0" class="text-light">‚Äî</span>
                            </td>
                            <td>
                                <button (click)="toggleTest(test)" class="badge cursor-pointer"
                                    [class.badge-green]="test.isActive !== false"
                                    [class.badge-red]="test.isActive === false" style="cursor:pointer; border:none;">
                                    {{ test.isActive !== false ? '‚óè Active' : '‚óè Inactive' }}
                                </button>
                            </td>
                            <td class="text-mid text-sm">{{ test.createdAt | date:'shortDate' }}</td>
                            <td>
                                <div class="flex gap-2">
                                    <button (click)="copyLink(test)" class="btn btn-ghost btn-sm"
                                        [style.color]="copiedLink === test._id ? 'var(--green)' : ''">
                                        {{ copiedLink === test._id ? '‚úì Copied' : 'üìã Link' }}
                                    </button>
                                    <a [routerLink]="['/admin/test', test._id, 'results']"
                                        class="btn btn-ghost btn-sm text-primary">
                                        üìä Results
                                    </a>
                                    <button (click)="deleteTest(test)" class="btn btn-ghost btn-sm"
                                        style="color:var(--red);">
                                        üóë Delete
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- No Tests -->
        <div *ngIf="!isLoading && tests.length === 0" class="glass-card p-12 text-center">
            <p class="text-mid text-lg mb-4">No tests created yet.</p>
            <a routerLink="/admin/create-test" class="btn btn-primary">Create Your First Test</a>
        </div>

        <!-- Recent Activity -->
        <div *ngIf="stats.recentAttempts?.length > 0" class="glass-card overflow-hidden mt-8">
            <div class="px-6 py-4" style="border-bottom:1px solid #f1f5f9; background:rgba(248,250,252,0.5);">
                <h3 class="text-lg font-bold text-dark">Recent Activity</h3>
            </div>
            <div>
                <div *ngFor="let attempt of stats.recentAttempts" class="list-item">
                    <div class="flex-between">
                        <span class="font-bold text-primary">{{ attempt.studentName }}</span>
                        <span class="badge" [class.badge-green]="attempt.score >= (attempt.totalQuestions * 0.6)"
                            [class.badge-red]="attempt.score < (attempt.totalQuestions * 0.6)">
                            {{ attempt.score }} / {{ attempt.totalQuestions }}
                        </span>
                    </div>
                    <div class="flex-between text-sm text-mid">
                        <span>{{ attempt.test?.title }}</span>
                        <span>{{ attempt.endTime | date:'medium' }}</span>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>