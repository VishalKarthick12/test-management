<div class="page-wrapper py-12 px-4" style="min-height:100vh;">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <div class="container relative z-10">
        <!-- Header -->
        <div class="flex-between mb-10 flex-wrap gap-4">
            <div>
                <h2 class="text-3xl font-bold gradient-text" style="display:inline-block;">Question Bank</h2>
                <p class="text-mid mt-2">Upload, manage, and delete questions.</p>
            </div>
            <a routerLink="/admin" class="btn btn-ghost">‚Üê Back to Dashboard</a>
        </div>

        <!-- Alerts -->
        <div *ngIf="error" class="alert alert-error mb-6">{{ error }}</div>
        <div *ngIf="success" class="alert alert-success mb-6">{{ success }}</div>

        <!-- Excel Format Guide -->
        <div class="glass-card mb-8 overflow-hidden">
            <div class="p-6" style="background:rgba(238,242,255,0.3); border-bottom:1px solid #f1f5f9;">
                <h3 class="font-bold text-dark text-base mb-3">üìã Required Excel Format</h3>
                <div class="overflow-x-auto">
                    <table class="data-table" style="font-size:13px;">
                        <thead>
                            <tr>
                                <th>question</th>
                                <th>type</th>
                                <th>options</th>
                                <th>correct_answer</th>
                                <th>difficulty</th>
                                <th>category</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="text-mid">Which command...</td>
                                <td class="text-mid">multiple_choice</td>
                                <td class="text-mid">opt1|opt2|opt3|opt4</td>
                                <td class="text-mid">opt1</td>
                                <td class="text-mid">easy</td>
                                <td class="text-mid">linux</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="flex gap-4 mt-3 flex-wrap">
                    <span class="text-xs text-mid">
                        <strong>type:</strong> multiple_choice or true_false
                    </span>
                    <span class="text-xs text-mid">
                        <strong>options:</strong> pipe "|" separated
                    </span>
                    <span class="text-xs text-mid">
                        <strong>difficulty:</strong> easy, medium, or hard
                    </span>
                    <button (click)="downloadTemplate()" class="btn btn-primary btn-sm" style="margin-left:auto;">
                        üì• Download Sample Template
                    </button>
                </div>
            </div>
        </div>

        <!-- Upload Card -->
        <div class="glass-card mb-10 overflow-hidden">
            <div class="p-8">
                <div style="display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:24px;">
                    <div style="flex:1; min-width:260px;">
                        <h3 class="text-xl font-bold text-dark mb-2">Upload Excel File</h3>
                        <p class="text-sm text-mid" style="max-width:500px;">
                            Select your <code
                                style="background:#eef2ff; color:var(--primary-dark); padding:2px 6px; border-radius:4px; font-size:12px;">.xlsx</code>
                            file with the columns shown above.
                        </p>
                    </div>

                    <div class="flex items-center gap-4 flex-wrap">
                        <label class="file-upload-label">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                            </svg>
                            {{ file ? file.name : 'Choose File' }}
                            <input type="file" (change)="onFileSelected($event)" accept=".xlsx" style="display:none" />
                        </label>

                        <button (click)="uploadFile()" [disabled]="isUploading || !file" class="btn btn-primary">
                            <span *ngIf="isUploading" class="spinner spinner-sm"
                                style="border-color:rgba(255,255,255,0.3); border-top-color:#fff;"></span>
                            {{ isUploading ? 'Processing...' : 'Upload & Preview' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Preview Table -->
        <div *ngIf="questions.length > 0" class="glass-card overflow-hidden mb-10">
            <div class="px-6 py-4 flex-between"
                style="border-bottom:1px solid #f1f5f9; background:rgba(248,250,252,0.5);">
                <h3 class="font-bold text-dark">üì§ Upload Preview <span class="text-sm font-medium text-mid">({{
                        questions.length }})</span></h3>
                <button (click)="saveQuestions()" [disabled]="isUploading" class="btn btn-success btn-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    Save {{ questions.length }} Questions
                </button>
            </div>

            <div class="overflow-x-auto">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width:40px;">#</th>
                            <th>Question</th>
                            <th>Type</th>
                            <th>Options</th>
                            <th>Correct Answer</th>
                            <th>Difficulty</th>
                            <th>Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let q of questions; let i = index">
                            <td class="text-light">{{ i + 1 }}</td>
                            <td class="font-medium">{{ q.text }}</td>
                            <td class="text-mid">{{ q.type }}</td>
                            <td class="text-mid">
                                <ul style="list-style:disc; padding-left:20px;">
                                    <li *ngFor="let opt of q.options" style="margin-bottom:2px;">{{ opt }}</li>
                                </ul>
                            </td>
                            <td class="font-bold text-green">{{ q.correctAnswer }}</td>
                            <td>
                                <span class="badge"
                                    [style.background]="q.difficulty === 'easy' ? '#dcfce7' : q.difficulty === 'hard' ? '#fef2f2' : '#fef3c7'"
                                    [style.color]="q.difficulty === 'easy' ? '#166534' : q.difficulty === 'hard' ? '#991b1b' : '#92400e'">
                                    {{ q.difficulty }}
                                </span>
                            </td>
                            <td class="text-mid">{{ q.category }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Saved Questions Section -->
        <div class="glass-card overflow-hidden">
            <div class="px-6 py-4 flex-between"
                style="border-bottom:1px solid #f1f5f9; background:rgba(248,250,252,0.5);">
                <h3 class="font-bold text-dark">
                    üìö Saved Questions
                    <span class="text-sm font-medium text-mid">({{ savedQuestions.length }})</span>
                </h3>
                <div class="flex gap-2">
                    <button *ngIf="savedQuestions.length > 0" (click)="deleteAllQuestions()"
                        class="btn btn-danger btn-sm">
                        üóë Delete All
                    </button>
                </div>
            </div>

            <div *ngIf="savedLoading" class="flex-center py-8">
                <div class="spinner spinner-sm"></div>
                <span class="text-mid ml-3">Loading questions...</span>
            </div>

            <div *ngIf="!savedLoading && savedQuestions.length === 0" class="p-8 text-center">
                <p class="text-mid">No questions saved yet. Upload an Excel file above to get started.</p>
            </div>

            <div *ngIf="!savedLoading && savedQuestions.length > 0" class="overflow-x-auto">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width:40px;">#</th>
                            <th>Question</th>
                            <th>Type</th>
                            <th>Options</th>
                            <th>Difficulty</th>
                            <th>Category</th>
                            <th style="width:80px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let q of savedQuestions; let i = index">
                            <td class="text-light">{{ i + 1 }}</td>
                            <td class="font-medium" style="max-width:300px;">{{ q.text }}</td>
                            <td class="text-mid">{{ q.type }}</td>
                            <td class="text-mid text-sm">
                                {{ q.options?.join(', ') }}
                            </td>
                            <td>
                                <span class="badge"
                                    [style.background]="q.difficulty === 'easy' ? '#dcfce7' : q.difficulty === 'hard' ? '#fef2f2' : '#fef3c7'"
                                    [style.color]="q.difficulty === 'easy' ? '#166534' : q.difficulty === 'hard' ? '#991b1b' : '#92400e'">
                                    {{ q.difficulty || 'medium' }}
                                </span>
                            </td>
                            <td class="text-mid">{{ q.category || 'General' }}</td>
                            <td>
                                <button (click)="deleteQuestion(q)" class="btn btn-ghost btn-sm"
                                    style="color:var(--red); padding:4px 8px;">
                                    üóë
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>