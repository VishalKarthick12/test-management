<div class="page-wrapper" style="min-height:100vh; display:flex; flex-direction:column;">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <!-- Tab Switch Warning -->
    <div *ngIf="showTabWarning"
        style="position:fixed; top:0; left:0; right:0; z-index:9999; background:linear-gradient(135deg,#ef4444,#dc2626); color:#fff; padding:14px 24px; text-align:center; font-weight:700; font-size:15px; box-shadow:0 4px 20px rgba(239,68,68,0.4); animation:slideDown 0.3s ease;">
        ⚠️ Tab switch detected! ({{ tabSwitchCount }}/3) — Your test will be auto-submitted after 3 switches.
    </div>

    <!-- Header / Timer Bar -->
    <header class="glass-nav" style="padding-left:24px; padding-right:24px;">
        <div class="flex items-center gap-3">
            <div style="padding:8px; background:#eef2ff; border-radius:10px; color:var(--primary);">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
            </div>
            <h1 class="text-xl font-bold text-dark">{{ testTitle || 'Assessment' }}</h1>
        </div>

        <div style="text-align:right;">
            <div class="text-xs text-light font-semibold uppercase tracking-wider">Time Remaining</div>
            <div class="text-2xl font-bold mono" [style.color]="timeRemaining > 60 ? 'var(--primary)' : 'var(--red)'"
                [class.pulse]="timeRemaining <= 60">
                {{ formatTime(timeRemaining) }}
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow relative z-10" style="max-width:860px; margin:0 auto; width:100%; padding:32px 16px;">
        <div *ngIf="currentQuestion" class="glass-card p-8">

            <!-- Question Header -->
            <div class="flex-between mb-8">
                <span class="badge badge-primary font-bold">
                    Question {{ currentQuestionIndex + 1 }} / {{ questions.length }}
                </span>
                <span class="text-sm text-light italic">Single Choice</span>
            </div>

            <!-- Question Text -->
            <h2 class="text-2xl font-bold text-dark mb-10 leading-relaxed">
                {{ currentQuestion.text }}
            </h2>

            <!-- Options -->
            <div style="display:flex; flex-direction:column; gap:14px;">
                <button *ngFor="let option of currentQuestion.options; let i = index" (click)="selectOption(i)"
                    class="option-btn" [class.selected]="getSelectedOption() === i">
                    <div class="option-radio">
                        <svg *ngIf="getSelectedOption() === i" class="option-check" xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 20 20" fill="white">
                            <path fill-rule="evenodd"
                                d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <span class="text-lg font-medium">{{ option }}</span>
                </button>
            </div>
        </div>
    </main>

    <!-- Navigation Footer -->
    <footer class="glass-nav" style="border-top:1px solid rgba(255,255,255,0.3); border-bottom:none;">
        <div
            style="max-width:860px; margin:0 auto; width:100%; display:flex; justify-content:space-between; align-items:center;">
            <button (click)="prevQuestion()" [disabled]="currentQuestionIndex === 0" class="btn btn-ghost">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                Previous
            </button>

            <!-- Progress Dots -->
            <div class="flex gap-2" style="display:none;">
                <!-- Hidden on mobile, optional on desktop -->
            </div>

            <button *ngIf="currentQuestionIndex < questions.length - 1" (click)="nextQuestion()"
                class="btn btn-primary">
                Next
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>

            <button *ngIf="currentQuestionIndex === questions.length - 1" (click)="submitTest()"
                class="btn btn-success btn-lg">
                Submit Assessment
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
            </button>
        </div>
    </footer>
</div>